<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">
    <!--<link rel="icon" href="lib/favicon.ico">-->
    <title>Waste Time Counter</title>
    <!-- Bootstrap core CSS -->
    <link href="lib/css/bootstrap.min.css" rel="stylesheet">
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <link href="lib/css/ie10-viewport-bug-workaround.css" rel="stylesheet">
    <!-- Custom styles for this template -->
    <link href="cover.css" rel="stylesheet">
    <!-- Just for debugging purposes. Don't actually copy these 2 lines! -->
    <!--[if lt IE 9]>
  <script src="lib/js/ie8-responsive-file-warning.js"></script><![endif]-->
    <script src="lib/js/ie-emulation-modes-warning.js"></script>
    <script src="lib/js/jquery-3.1.1.min.js"></script>
    <script src="lib/js/oauth.js"></script>
    <script src="lib/js/jquery.cookie.js"></script>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
  <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
  <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->
    <script type="text/javascript">
        var Timer;
        var TotalSeconds;
        var Wasters_1;
        var FontSize;
        $(document).ready(function () {
            var lastSession = Cookies.get('last_session');
            var totalSeconds = 0;
            var wasters = 1;
            var fontSize = 14;
            if (!$.isEmptyObject(lastSession)) {
                lastSession = JSON.parse(lastSession);
                totalSeconds = parseInt(lastSession.total_seconds);
                if (totalSeconds == 'NaN') {
                    totalSeconds = 0
                }
                wasters = parseInt(lastSession.wasters);
                if (wasters == 'NaN') {
                    wasters = 1
                }
                fontSize = parseInt(lastSession.font_size);
                if (fontSize == 'NaN') {
                    fontSize = 14
                }
            }
            CreateTimer("timer", totalSeconds, wasters, fontSize);
        });

        function CreateTimer(TimerID, Time, Wasters, fontSize) {
            Timer = $('#' + TimerID + '');
            TotalSeconds = Time;
            FontSize = fontSize;
            $('#wastersCount').css('font-size', FontSize + 'px');
            $('#wastersCount').text(Wasters);
            Wasters_1 = Wasters;
            UpdateTimer();
            setTimeout(function () {
                Tick()
            }, 1000);
        }

        function watersAdd() {
            var wastersCount = $('#wastersCount');
            var wasters = parseInt(wastersCount.text());
            wasters += 1;
            wastersCount.text(wasters);
            var fontSize = parseInt(wastersCount.css('font-size'));
            if (fontSize < 80) {
                wastersCount.css('font-size', ++fontSize + 'px');
            }
            updateTick();
        }

        function wastersRemove() {
            var wastersCount = $('#wastersCount');
            var wasters = parseInt(wastersCount.text());
            if (wasters > 1) {
                wasters -= 1;
                wastersCount.text(wasters);
            }
            var fontSize = parseInt(wastersCount.css('font-size'));
            if (fontSize > 16) {
                wastersCount.css('font-size', --fontSize + 'px');
            }
            updateTick();
        }

        function updateTick() {
            Wasters_1 = parseInt($('#wastersCount').text());
        }

        function Tick() {
            TotalSeconds += Wasters_1;
            UpdateTimer();
            setTimeout(function () {
                Tick()
            }, 1000);
        }

        function UpdateTimer() {
            var hours = parseInt(TotalSeconds / 3600) % 24;
            var minutes = parseInt(TotalSeconds / 60) % 60;
            var seconds = TotalSeconds % 60;
            var result = (hours < 10 ? "0" + hours : hours) + " : " + (minutes < 10 ? "0" + minutes : minutes) + " : " + (seconds < 10 ? "0" + seconds : seconds) + " sec";
            updateLastSession();
            Timer.text(result);
        }

        function updateLastSession() {
            var fontSize = parseInt($('#wastersCount').css('font-size'));
            var lastSesstion = {
                'total_seconds': TotalSeconds
                , 'wasters': Wasters_1
                , 'font_size': fontSize
            }
            Cookies.set('last_session', lastSesstion);
        }

        function updateWasterName(response) {
            var token = response.authResponse.accessToken;
            var userID = response.authResponse.userID;
            $.getJSON('https://graph.facebook.com/me?access_token=' + token, function (data) {
                var id = data.id;
                var name = data.name;
                $('#waster').text(name);
            });
        }

        function getStatus() {
            FB.getLoginStatus(function (response) {
                if (response.status === 'connected') {
                    console.log('Logged in.');
                    updateWasterName(response);
                }
                else {
                    FB.login(function (response) {
                        if (response.status === 'connected') {
                            updateWasterName(response);
                        }
                        else if (response.status === 'not_authorized') {
                            console.log('not_authorized');
                        }
                        else {
                            console.log('unknown');
                        }
                    }, {
                        scope: 'public_profile,email'
                    });
                }
            });
        }

        function initFacebook() {
            window.fbAsyncInit = function () {
                FB.init({
                    //                    appId: '721208764722489'
                    appId: '721252094718156'
                    , xfbml: true
                    , version: 'v2.8'
                });
                FB.AppEvents.logPageView();
                getStatus();
            };
            (function (d, s, id) {
                var js, fjs = d.getElementsByTagName(s)[0];
                if (d.getElementById(id)) {
                    return;
                }
                js = d.createElement(s);
                js.id = id;
                js.src = "//connect.facebook.net/en_US/sdk.js";
                fjs.parentNode.insertBefore(js, fjs);
            }(document, 'script', 'facebook-jssdk'));
        }
    </script>
</head>

<body>
    <script>
        initFacebook();
    </script>
    <div class="site-wrapper">
        <div class="site-wrapper-inner">
            <div class="cover-container">
                <div class="masthead clearfix">
                    <div class="inner">
                        <h3 class="masthead-brand"><font style="color: red">W</font>TC</h3>
                        <nav>
                            <ul class="nav masthead-nav">
                                <li class="active"><a href="#">Go Home! You are <font style="color: red">wasting</font> your time <span id="waster" style="color:green;"></span></a></li>
                            </ul>
                        </nav>
                    </div>
                </div>
                <div class="inner cover">
                    <h1 class="cover-heading"><font style="color: red">Waste</font> Time Counter.</h1>
                    <p class="lead">Let's <font style="color: red">waste</font> together!</p>
                    <p>Number Of <font style="color: red">Wasters</font></p>
                    <p id="wastersCount" style="color:white;font-size: 16px;">1</p>
                    <div class="row">
                        <p id="timer" style="font-size: 26px;">TIMER</p>
                    </div>
                    <p class="lead"> <a href="#" id="wastersClick" class="btn btn-lg btn-default" onclick="watersAdd();">MORE <font style="color: red">Wasters</font></a> <a href="#" id="wastersRemove" class="btn btn-lg btn-default" onclick="wastersRemove();">Leave <font style="color: red">Wasters</font> alone</a> </p>
                </div>
            </div>
        </div>
    </div>
    <!-- Bootstrap core JavaScript
================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script>
        window.jQuery || document.write('<script src="lib/js/vendor/jquery.min.js"><\/script>')
    </script>
    <script src="lib/js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="lib/js/ie10-viewport-bug-workaround.js"></script>
</body>

</html>
